<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extension for DALEX Package â€¢ DALEXtra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="dalexverse.css" rel="stylesheet">
<link href="dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Extension for DALEX Package">
<meta property="og:description" content="Provides wrapper of various machine learning models. 
  In applied machine learning, there 
  is a strong belief that we need to strike a balance 
  between interpretability and accuracy. 
  However, in field of the interpretable machine learning, 
  there are more and more new ideas for explaining black-box models, 
  that are implemented in R. 
  DALEXtra creates DALEX Biecek (2018) &lt;arXiv:1806.08915&gt; explainer for many type of models
  including those created using python scikit-learn and keras libraries, and java h2o library. 
  Important part of the package is Champion-Challenger analysis and innovative approach
  to model performance across subsets of test data presented in Funnel Plot. 
  Third branch of DALEXtra package is aspect importance analysis
  that provides instance-level explanations for the groups of explanatory variables.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="index.html">DALEXtra</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.2.3</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/vignette_aspect_importance.html">Aspect importance function examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/DALEXtra/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="dalextra-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#dalextra-" class="anchor"></a>DALEXtra <img src="reference/figures/logo.png" align="right" width="150">
</h1></div>

</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>The <code>DALEXtra</code> package is an extension pack for <a href="https://modeloriented.github.io/DALEX">DALEX</a> package. It contains various tools for XAI (eXplainable Artificial Intelligence) that can help us inspect and improve our model. Functionalities of the <code>DALEXtra</code> could be divided into three areas.</p>
<ul>
<li>Champion-Challenger analysis
<ul>
<li>Lets us compare two or more Machine-Learning models, determinate which one is better and improve both of them.</li>
<li>Funnel Plot of performance measures as an innovative approach to measure comparison.</li>
<li>Automatic HTML report.</li>
</ul>
</li>
<li>Cross langauge comaprison
<ul>
<li>Creating explainers for models created in different languges so they can be explained using R tools like <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a> family.</li>
<li>Currently supported are <strong>Python</strong> <em>scikit-learn</em> and <em>keras</em>, <strong>Java</strong> <em>h2o</em> and <em>mljar</em>, <strong>R</strong> <em>mlr</em> and <em>mlr3</em>.</li>
</ul>
</li>
<li>Aspect Importance analysis
<ul>
<li>Provides instance-level explanations for the groups of explanatory variables.</li>
</ul>
</li>
</ul>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># Install the development version from GitHub:</span>

<span class="co"># it is recommended to install latest version of DALEX from GitHub</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/DALEX"</span>)
<span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/DALEXtra"</span>)</pre></div>
<p>or latest CRAN version</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"DALEX"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"DALEXtra"</span>)</pre></div>
<p>Other packages useful with explanations.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/ingredients"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/iBreakDown"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/shapper"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/auditor"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ModelOriented/modelStudio"</span>)</pre></div>
<p>Above packages can be used along with <code>explain</code> object to create explanations (ingredients, iBreakDown, shapper), audit our model (auditor) or automate the model exploration process (modelStudio).</p>
</div>
</div>
<div id="champion-challenger-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#champion-challenger-analysis" class="anchor"></a>Champion-Challenger analysis</h1>
<p>Without aby doubt, comaprison of models, espacially black-box ones is very important use case nowadays. Every day new models are being created and we need tools that can allow us to determinate which one is better. For this purpose we present Champion-Challenger analysis. It is set of functions that creates comaprisons of models and later can be gathered up to created one report with generic comments. Example of report can be found <a href="http://htmlpreview.github.io/?https://github.com/ModelOriented/DALEXtra/blob/master/inst/ChampionChallenger/DALEXtra_example_of_report.html">here</a>. As you can see any explenation that has generic <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> function can be plotted.</p>
<div id="funnel-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#funnel-plot" class="anchor"></a>Funnel Plot</h2>
<p>Core of our analysis is funnel plot. It lets us find subsets of data where one of models is significantly better than other ones. That ability is insanely usefull, when we have models that have similiar overall performance and we want to know which one should we use.</p>
<div class="sourceCode" id="cb4"><pre class="r"> <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"mlr"</span>)
 <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEXtra"</span>)
 <span class="no">task</span> <span class="kw">&lt;-</span> <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/RegrTask.html">makeRegrTask</a></span>(
   <span class="kw">id</span> <span class="kw">=</span> <span class="st">"R"</span>,
   <span class="kw">data</span> <span class="kw">=</span> <span class="no">apartments</span>,
   <span class="kw">target</span> <span class="kw">=</span> <span class="st">"m2.price"</span>
 )
 <span class="no">learner_lm</span> <span class="kw">&lt;-</span> <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html">makeLearner</a></span>(
   <span class="st">"regr.lm"</span>
 )
 <span class="no">model_lm</span> <span class="kw">&lt;-</span> <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/train.html">train</a></span>(<span class="no">learner_lm</span>, <span class="no">task</span>)
 <span class="no">explainer_lm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/explain_mlr.html">explain_mlr</a></span>(<span class="no">model_lm</span>, <span class="no">apartmentsTest</span>, <span class="no">apartmentsTest</span>$<span class="no">m2.price</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="st">"LM"</span>,
                             <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">precalculate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

 <span class="no">learner_rf</span> <span class="kw">&lt;-</span> <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html">makeLearner</a></span>(
   <span class="st">"regr.randomForest"</span>
 )
 <span class="no">model_rf</span> <span class="kw">&lt;-</span> <span class="kw pkg">mlr</span><span class="kw ns">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/train.html">train</a></span>(<span class="no">learner_rf</span>, <span class="no">task</span>)
 <span class="no">explainer_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/explain_mlr.html">explain_mlr</a></span>(<span class="no">model_rf</span>, <span class="no">apartmentsTest</span>, <span class="no">apartmentsTest</span>$<span class="no">m2.price</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="st">"RF"</span>,
                             <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">precalculate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

 <span class="no">plot_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/funnel_measure.html">funnel_measure</a></span>(<span class="no">explainer_lm</span>, <span class="no">explainer_rf</span>,
                             <span class="kw">partition_data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">apartmentsTest</span>,
                                                    <span class="st">"m2.per.room"</span> <span class="kw">=</span> <span class="no">apartmentsTest</span>$<span class="no">surface</span>/<span class="no">apartmentsTest</span>$<span class="no">no.rooms</span>),
                             <span class="kw">nbins</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">measure_function</span> <span class="kw">=</span> <span class="kw pkg">DALEX</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/DALEX/man/loss_functions.html">loss_root_mean_square</a></span>, <span class="kw">show_info</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></div>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">plot_data</span>)<span class="kw">[[</span><span class="fl">1</span>]]</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-5-1.png" style="display: block; margin: auto;"> Such situation is shown in the following plot. Both, <code>LM</code> and <code>RF</code> models have smiliar RMSE, but Funnel Plot shows that if we want to predict expensive or cheap apartemnts, we definetly should use <code>LM</code> while <code>RF</code> for average priced apartments. Also without any doubt <code>LM</code> is much better than <code>RF</code> for <code>Srodmiescie</code> district. Following use case show us how powerfull tool can Funnel Plot be, for example we can compund two or models into one based of areas acquired from the Plot and thus improve our models. One another advantage of Funnel Plot is that it doesnâ€™t require model to be fitted with Variables shown on the plot, as you can see, <code>m2.per.room</code> is an artificial variable.</p>
</div>
</div>
<div id="cross-langauge-comaprison" class="section level1">
<h1 class="hasAnchor">
<a href="#cross-langauge-comaprison" class="anchor"></a>Cross langauge comaprison</h1>
<p>Here we will present short use case for our package and its compatibility with Python.</p>
<div id="how-to-setup-anaconda" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-setup-anaconda" class="anchor"></a>How to setup Anaconda</h2>
<p>In order to be able to use some features associated with <code>DALEXtra</code>, Anaconda in needed. The easiest way to get it, is visiting <a href="https://www.anaconda.com/distribution">Anaconda website</a>. And choosing proper OS as it stands in the following picture. <img src="https://raw.githubusercontent.com/ModelOriented/DALEXtra/master/README_files/figure-gfm/anaconda1.png"> There is no big difference bewtween Python versions when downloading Anaconda. You can always create virtual environment with any version of Python no matter which version was downloaded first.</p>
<div id="windows" class="section level3">
<h3 class="hasAnchor">
<a href="#windows" class="anchor"></a>Windows</h3>
<p>Crucial thing is adding conda to PATH environment variable when using Windows. You can do it during the installation, by marking this checkbox.</p>
<center>
<p><img src="https://raw.githubusercontent.com/ModelOriented/DALEXtra/master/README_files/figure-gfm/anaconda2.png"></p>
</center>
<p>or, if conda is already installed, follow <a href="https://stackoverflow.com/a/44597801/9717584">those instructions</a>.</p>
</div>
<div id="unix" class="section level3">
<h3 class="hasAnchor">
<a href="#unix" class="anchor"></a>Unix</h3>
<p>While using unix-like OS, adding conda to PATH is not required.</p>
</div>
<div id="loading-data" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h3>
<p>First we need provide the data, explainer is useless without them. Thing is Python object does not store training data so always have to provide dataset. Feel free to use those attached to <code>DALEX</code> package or those stored in <code>DALEXtra</code> files.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">titanic_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"titanic_test.csv"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"DALEXtra"</span>))</pre></div>
<p>Keep in mind that dataframe includes target variable (18th column) and scikit-learn models cannot work with it.</p>
</div>
<div id="creating-explainer" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-explainer" class="anchor"></a>Creating explainer</h3>
<p>Creating exlainer from scikit-learn Python model is very simple thanks to <code>DALEXtra</code>. The only thing you need to provide is path to pickle and, if necessary, something that lets recognize Python environment. It may be a .yml file with packages specification, name of existing conda environment or path to Python virtual environment. Execution of <code>scikitlearn_explain</code> only with .pkl file and data will cause usage of default Python.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DALEXtra</span>)
<span class="no">explainer</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/explain_scikitlearn.html">explain_scikitlearn</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"scikitlearn.pkl"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"DALEXtra"</span>),
<span class="kw">yml</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"testing_environment.yml"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"DALEXtra"</span>),
<span class="kw">data</span> <span class="kw">=</span> <span class="no">titanic_test</span>[,<span class="fl">1</span>:<span class="fl">17</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">titanic_test</span>$<span class="no">survived</span>, <span class="kw">colorize</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">## Preparation of a new explainer is initiated</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">##   -&gt; model label       :  scikitlearn_model  (  default  )</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">##   -&gt; data              :  524  rows  17  cols </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">##   -&gt; target variable   :  524  values </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">##   -&gt; model_info        :  package reticulate , ver. 1.15 , task classification (  default  ) </span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">##   -&gt; predict function  :  yhat.scikitlearn_model  will be used (  default  )</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">##   -&gt; predicted values  :  numerical, min =  0.02086126 , mean =  0.288584 , max =  0.9119996  </span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">##   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">##   -&gt; residuals         :  numerical, min =  -0.8669431 , mean =  0.02248468 , max =  0.9791387  </span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">##   A new explainer has been created!</span></span></code></pre></div>
<p>Now with explainer ready we can use any of <a href="https://github.com/ModelOriented/DrWhy/blob/master/README.md">DrWhy.Ai</a> universe tools to make explanations. Here is a small demo.</p>
</div>
<div id="creating-explanations" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-explanations" class="anchor"></a>Creating explanations</h3>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DALEX</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/DALEX/man/model_performance.html">model_performance</a></span>(<span class="no">explainer</span>))</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-1.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ingredients</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ingredients/man/feature_importance.html">feature_importance</a></span>(<span class="no">explainer</span>))</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-2.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ingredients/man/describe.html">describe</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ingredients/man/feature_importance.html">feature_importance</a></span>(<span class="no">explainer</span>))</pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">## The number of important variables for scikitlearn_model's prediction is 4 out of 17. </span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">##  Variables gender.female, gender.male, age have the highest importantance.</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">iBreakDown</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/iBreakDown/man/break_down.html">break_down</a></span>(<span class="no">explainer</span>, <span class="no">titanic_test</span>[<span class="fl">2</span>, <span class="fl">1</span>:<span class="fl">17</span>]))</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-3.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/iBreakDown/man/describe.html">describe</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/iBreakDown/man/break_down.html">break_down</a></span>(<span class="no">explainer</span>, <span class="no">titanic_test</span>[<span class="fl">2</span>, <span class="fl">1</span>:<span class="fl">17</span>]))</pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">## Scikitlearn_model predicts, that the prediction for the selected instance is 0.132 which is lower than the average model prediction.</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">## </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">## The most important variable that decrease the prediction is class.3rd.</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">## </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">## Other variables are with less importance. The contribution of all other variables is -0.108.</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">auditor</span>)
<span class="no">eval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/auditor/man/model_evaluation.html">model_evaluation</a></span>(<span class="no">explainer</span>)
<span class="fu"><a href="https://rdrr.io/pkg/auditor/man/plot_roc.html">plot_roc</a></span>(<span class="no">eval</span>)</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-4.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="r"><span class="co"># Predictions with newdata</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">explainer</span>, <span class="no">titanic_test</span>[<span class="fl">1</span>:<span class="fl">10</span>, <span class="fl">1</span>:<span class="fl">17</span>])</pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">##  [1] 0.3565896 0.1321947 0.7638813 0.1037486 0.1265221 0.2949228 0.1421281</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co">##  [8] 0.1421281 0.4154695 0.1321947</span></span></code></pre></div>
</div>
</div>
</div>
<div id="aspect-importance" class="section level1">
<h1 class="hasAnchor">
<a href="#aspect-importance" class="anchor"></a>Aspect importance</h1>
<p>Aspect importance function provides instance-level explanations for the groups of explanatory variables. It enables grouping predictors into entities called aspects. Afterwards, it can calculate the contribution of those aspects to the prediction.</p>
<p>To illustrate how the function works, we use titanic example. We build random forest model, group features into aspects and choose new observation to be explained. Then we build <code>DALEX</code> explainer and use it to call aspect importance function. Finally, we print and plot function results. We can observe that <code>personal</code> (<code>age</code> and <code>gender</code>) variables have the biggest contribution to the prediction. This contribution is of a positive type.</p>
<div class="sourceCode" id="cb19"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEX"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"randomForest"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEXtra"</span>)
<span class="no">titanic</span> <span class="kw">&lt;-</span> <span class="no">titanic_imputed</span>
<span class="no">titanic</span>$<span class="no">country</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="no">titanic_without_target</span> <span class="kw">&lt;-</span> <span class="no">titanic</span>[,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">titanic</span>)<span class="kw">!=</span><span class="st">"survived"</span>]
<span class="no">aspects_titanic</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">wealth</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"class"</span>, <span class="st">"fare"</span>),
    <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sibsp"</span>, <span class="st">"parch"</span>),
    <span class="kw">personal</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"gender"</span>),
    <span class="kw">embarked</span> <span class="kw">=</span> <span class="st">"embarked"</span>
  )
<span class="no">passenger</span> <span class="kw">&lt;-</span> <span class="no">titanic_without_target</span>[<span class="fl">4</span>,]
<span class="no">model_titanic_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">survived</span>) <span class="kw">==</span> <span class="st">"yes"</span> ~ <span class="no">gender</span> + <span class="no">age</span> +
                                   <span class="no">class</span> + <span class="no">embarked</span> + <span class="no">fare</span> + <span class="no">sibsp</span> + <span class="no">parch</span>,
                                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">titanic</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">model_titanic_rf</span>, <span class="no">passenger</span>)</pre></div>
<div class="sourceCode" id="cb20"><pre class="r"><span class="no">explain_titanic_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(<span class="no">model_titanic_rf</span>,
                               <span class="kw">data</span> <span class="kw">=</span> <span class="no">titanic_without_target</span>,
                               <span class="kw">y</span> <span class="kw">=</span> <span class="no">titanic</span>$<span class="no">survived</span> <span class="kw">==</span> <span class="st">"yes"</span>,
                               <span class="kw">predict_function</span> <span class="kw">=</span> <span class="no">predict</span>,
                               <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">titanic_rf_ai</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/aspect_importance.html">aspect_importance</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">explain_titanic_rf</span>,
                                   <span class="kw">new_observation</span> <span class="kw">=</span> <span class="no">passenger</span>,
                                   <span class="kw">aspects</span> <span class="kw">=</span> <span class="no">aspects_titanic</span>)
<span class="no">titanic_rf_ai</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">titanic_rf_ai</span>, <span class="kw">add_importance</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
<div id="automated-grouping" class="section level2">
<h2 class="hasAnchor">
<a href="#automated-grouping" class="anchor"></a>Automated grouping</h2>
<p>In examples described above, we had to manually group features into aspects. Aspect importance provides <code><a href="reference/group_variables.html">group_variables()</a></code> - function that automatically groups features for us, based on the features correlation. Function only works on numeric variables.</p>
<p>Below, we test aspect importance function on another dataset. But this time we build aspect list by running run <code><a href="reference/group_variables.html">group_variables()</a></code> (with cut off level set on 0.6). As a result, we get a list of variables groups (aspects) where absolute value of featuresâ€™ pairwise correlation is at least at 0.6.</p>
<div class="sourceCode" id="cb21"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DALEX</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"apartments"</span>)
<span class="no">apartments_num</span> <span class="kw">&lt;-</span> <span class="no">apartments</span>[,<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">apartments</span>, <span class="no">is.numeric</span>))]
<span class="no">apartments_no_target</span> <span class="kw">&lt;-</span> <span class="no">apartments_num</span>[,-<span class="fl">1</span>]
<span class="no">new_observation_apartments</span> <span class="kw">&lt;-</span> <span class="no">apartments_num</span>[<span class="fl">10</span>,]
<span class="no">model_apartments</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">m2.price</span> ~ <span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">apartments_num</span>)
<span class="no">aspects_apartments</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/group_variables.html">group_variables</a></span>(<span class="no">apartments_no_target</span>, <span class="fl">0.6</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">model_apartments</span>, <span class="no">new_observation_apartments</span>)</pre></div>
<div class="sourceCode" id="cb22"><pre class="r"><span class="no">explain_apartments</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(<span class="no">model_apartments</span>,
                               <span class="kw">data</span> <span class="kw">=</span> <span class="no">apartments_no_target</span>,
                               <span class="kw">y</span> <span class="kw">=</span> <span class="no">apartments</span>$<span class="no">m2.price</span>,
                               <span class="kw">predict_function</span> <span class="kw">=</span> <span class="no">predict</span>,
                               <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">apartments_ai</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/aspect_importance.html">aspect_importance</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">explain_apartments</span>,
                                   <span class="kw">new_observation</span> <span class="kw">=</span> <span class="no">new_observation_apartments</span>,
                                   <span class="kw">aspects</span> <span class="kw">=</span> <span class="no">aspects_apartments</span>,
                                   <span class="kw">N</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">show_cor</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">apartments_ai</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">apartments_ai</span>, <span class="kw">aspects_on_axis</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">add_importance</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
     <span class="kw">digits_to_round</span> <span class="kw">=</span> <span class="fl">0</span>)</pre></div>
</div>
</div>
<div id="acknowledgments" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>Work on this package was financially supported by the <code>NCN Opus grant 2016/21/B/ST6/02176</code>.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=DALEXtra">https://â€‹cloud.r-project.org/â€‹package=DALEXtra</a>
</li>
<li>Browse source code at <br><a href="https://github.com/ModelOriented/DALEXtra/">https://â€‹github.com/â€‹ModelOriented/â€‹DALEXtra/â€‹</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ModelOriented/DALEXtra/issues">https://â€‹github.com/â€‹ModelOriented/â€‹DALEXtra/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Szymon Maksymiuk <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3120-1601" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Przemyslaw Biecek <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-8423-1823" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Katarzyna Pekala <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/maksymiuks/DALEXtra/actions?query=workflow%3AR-CMD-check"><img src="https://github.com/maksymiuks/DALEXtra/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/github/ModelOriented/DALEXtra?branch=master"><img src="https://img.shields.io/codecov/c/github/ModelOriented/DALEXtra/master.svg" alt="Coverage Status"></a></li>
<li><a href="https://cran.r-project.org/package=DALEXtra"><img src="http://www.r-pkg.org/badges/version/DALEXtra" alt="CRAN_Status_Badge"></a></li>
<li><a href="http://cranlogs.r-pkg.org/badges/grand-total/DALEXtra"><img src="http://cranlogs.r-pkg.org/badges/grand-total/DALEXtra?color=orange" alt="Total Downloads"></a></li>
<li><a href="http://drwhy.ai/#BackBone"><img src="https://img.shields.io/badge/DrWhy-BackBone-373589" alt="DrWhy-eXtrAI"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Szymon Maksymiuk, Przemyslaw Biecek, Katarzyna Pekala.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
