<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Caluculate difference in performance in models across different categories — funnel_measure • DALEXtra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet"><link href="../dalexverse-2.css" rel="stylesheet"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Caluculate difference in performance in models across different categories — funnel_measure"><meta property="og:description" content="Function funnel_measure allows users to compare two models based on their explainers. It partitions dataset on which models were builded
and creates categories according to quantiles of columns in parition data. nbins parameter determinates number of qunatiles.
For each category difference in provided measure is being calculated. Positive value of that differnece means that Champion model
has better performance in specified category, while negative value means that one of the Challengers was better. Function allows
to compare multiple Challengers at once."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script></head><body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">DALEXtra</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/" class="external-link">MI^2 DataLab</a> </span>
          <span class="version version-default">2.1.1.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/DALEXtra/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Caluculate difference in performance in models across different categories</h1>
    <small class="dont-index">Source: <a href="https://github.com/ModelOriented/DALEXtra/blob/HEAD/R/funnel_measure.R" class="external-link"><code>R/funnel_measure.R</code></a></small>
    <div class="hidden name"><code>funnel_measure.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function <code>funnel_measure</code> allows users to compare two models based on their explainers. It partitions dataset on which models were builded
and creates categories according to quantiles of columns in <code>parition data</code>. <code>nbins</code> parameter determinates number of qunatiles.
For each category difference in provided measure is being calculated. Positive value of that differnece means that Champion model
has better performance in specified category, while negative value means that one of the Challengers was better. Function allows
to compare multiple Challengers at once.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">funnel_measure</span><span class="op">(</span>
  <span class="va">champion</span>,
  <span class="va">challengers</span>,
  measure_function <span class="op">=</span> <span class="cn">NULL</span>,
  nbins <span class="op">=</span> <span class="fl">5</span>,
  partition_data <span class="op">=</span> <span class="va">champion</span><span class="op">$</span><span class="va">data</span>,
  cutoff <span class="op">=</span> <span class="fl">0.01</span>,
  cutoff_name <span class="op">=</span> <span class="st">"Other"</span>,
  factor_conversion_threshold <span class="op">=</span> <span class="fl">7</span>,
  show_info <span class="op">=</span> <span class="cn">TRUE</span>,
  categories <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>champion</dt>
<dd><p>- explainer of champion model.</p></dd>
<dt>challengers</dt>
<dd><p>- explainer of challenger model or list of explainers.</p></dd>
<dt>measure_function</dt>
<dd><p>- measure function that calculates performance of model based on true observation and prediction.
Order of parameters is important and should be (y, y_hat). The measure calculated by the function
should have the property that lower score value indicates better model. If NULL, RMSE will be used for regression,
one minus auc for classification and crossentropy for multiclass classification.</p></dd>
<dt>nbins</dt>
<dd><p>- Number of qunatiles (partition points) for numeric columns. In case when more than one qunatile have the same value, there will be less partition points.</p></dd>
<dt>partition_data</dt>
<dd><p>- Data by which test dataset will be paritioned for computation. Can be either data.frame or character vector.
When second is passed, it has to indicate names of columns that will be extracted fromm test data.
By default full test data. If data.frame, number of rows has to be equal to number of rows in test data.</p></dd>
<dt>cutoff</dt>
<dd><p>- Threshold for categorical data. Entries less frequent than specified value will be merged into one category.</p></dd>
<dt>cutoff_name</dt>
<dd><p>- Name for new category that arised after merging entries less frequent than <code>cutoff</code></p></dd>
<dt>factor_conversion_threshold</dt>
<dd><p>- Numeric columns with lower number of unique values than value of this parameter will be treated as factors</p></dd>
<dt>show_info</dt>
<dd><p>- Logical value indicating if progress bar should be shown.</p></dd>
<dt>categories</dt>
<dd><p>- a named list of variable names that will be plotted in a different colour. By deafault it is partitioned on Explanatory, External and Target.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of the class <code>funnel_measure</code>It is a named list containing following fields:</p><ul><li><p><code>data</code> data.frame that consists of columns:</p><ul><li><p><code>Variable</code> Variable according to which partitions were made</p></li>
<li><p><code>Measure</code> Difference in measures. Positive value indicates that champion was better, while negative that challenger.</p></li>
<li><p><code>Label</code> String that defines subset of <code>Variable</code> values (partition rule).</p></li>
<li><p><code>Challenger</code> Label of challenger explainer that was used in <code>Measure</code></p></li>
<li><p><code>Category</code> a category of the variable passed to function</p></li>
</ul></li>
<li><p><code>models_info</code> data.frame containig inforamtion about models used in analysys</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr.mlr-org.com" class="external-link">"mlr"</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ModelOriented.github.io/DALEXtra/" class="external-link">"DALEXtra"</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/RegrTask.html" class="external-link">makeRegrTask</a></span><span class="op">(</span></span>
<span class="r-in">  id <span class="op">=</span> <span class="st">"R"</span>,</span>
<span class="r-in">  data <span class="op">=</span> <span class="va">apartments</span>,</span>
<span class="r-in">  target <span class="op">=</span> <span class="st">"m2.price"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">learner_lm</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="st">"regr.lm"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">learner_lm</span>, <span class="va">task</span><span class="op">)</span></span>
<span class="r-in"><span class="va">explainer_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain_mlr.html">explain_mlr</a></span><span class="op">(</span><span class="va">model_lm</span>, <span class="va">apartmentsTest</span>, <span class="va">apartmentsTest</span><span class="op">$</span><span class="va">m2.price</span>, label <span class="op">=</span> <span class="st">"LM"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparation of a new explainer is initiated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model label       :  LM </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; data              :  9000  rows  6  cols </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; target variable   :  9000  values </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict function  :  yhat.WrappedModel  will be used ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  No value for predict function target column. ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model_info        :  package mlr , ver. 2.19.0 , task regression ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  numerical, min =  1792.597 , mean =  3506.836 , max =  6241.447  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residual function :  difference between y and yhat ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residuals         :  numerical, min =  -257.2555 , mean =  4.687686 , max =  472.356  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;"> A new explainer has been created! </span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="va">learner_rf</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="st">"regr.ranger"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">learner_rf</span>, <span class="va">task</span><span class="op">)</span></span>
<span class="r-in"><span class="va">explainer_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain_mlr.html">explain_mlr</a></span><span class="op">(</span><span class="va">model_rf</span>, <span class="va">apartmentsTest</span>, <span class="va">apartmentsTest</span><span class="op">$</span><span class="va">m2.price</span>, label <span class="op">=</span> <span class="st">"RF"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparation of a new explainer is initiated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model label       :  RF </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; data              :  9000  rows  6  cols </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; target variable   :  9000  values </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict function  :  yhat.WrappedModel  will be used ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  No value for predict function target column. ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model_info        :  package mlr , ver. 2.19.0 , task regression ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  numerical, min =  1792.4 , mean =  3505.998 , max =  6253.683  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residual function :  difference between y and yhat ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residuals         :  numerical, min =  -533.6662 , mean =  5.525504 , max =  745.8761  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;"> A new explainer has been created! </span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="va">learner_gbm</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/makeLearner.html" class="external-link">makeLearner</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="st">"regr.gbm"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">model_gbm</span> <span class="op">&lt;-</span> <span class="fu">mlr</span><span class="fu">::</span><span class="fu"><a href="https://mlr.mlr-org.com/reference/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">learner_gbm</span>, <span class="va">task</span><span class="op">)</span></span>
<span class="r-in"><span class="va">explainer_gbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="explain_mlr.html">explain_mlr</a></span><span class="op">(</span><span class="va">model_gbm</span>, <span class="va">apartmentsTest</span>, <span class="va">apartmentsTest</span><span class="op">$</span><span class="va">m2.price</span>, label <span class="op">=</span> <span class="st">"GBM"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparation of a new explainer is initiated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model label       :  GBM </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; data              :  9000  rows  6  cols </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; target variable   :  9000  values </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predict function  :  yhat.WrappedModel  will be used ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  No value for predict function target column. ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; model_info        :  package mlr , ver. 2.19.0 , task regression ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; predicted values  :  numerical, min =  2112.667 , mean =  3503.111 , max =  6057.692  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residual function :  difference between y and yhat ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -&gt; residuals         :  numerical, min =  -543.3115 , mean =  8.412214 , max =  776.1234  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;"> A new explainer has been created! </span> </span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">funnel_measure</span><span class="op">(</span><span class="va">explainer_lm</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">explainer_rf</span>, <span class="va">explainer_gbm</span><span class="op">)</span>,</span>
<span class="r-in">                            nbins <span class="op">=</span> <span class="fl">5</span>, measure_function <span class="op">=</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="va"><a href="https://dalex.drwhy.ai/reference/loss_functions.html" class="external-link">loss_root_mean_square</a></span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |============                                                          |  17%  |                                                                              |=======================                                               |  33%  |                                                                              |===================================                                   |  50%  |                                                                              |===============================================                       |  67%  |                                                                              |==========================================================            |  83%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $challanger_RF</span>
<span class="r-plt img"><img src="funnel_measure-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $challanger_GBM</span>
<span class="r-plt img"><img src="funnel_measure-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>.</p>
</div>

      </footer></div>

  


  </body></html>

